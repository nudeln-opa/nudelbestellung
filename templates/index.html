<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>ü•≥ Nudelbestellung</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>

    <h1>ü•≥ Nudelbestellung</h1>
    <h3>Nudeln wie zu Omas Zeiten ‚Äì Ohne Geschmacksverst√§rker und Aromen</h3>

    <form action="/submit" method="POST">
        <label for="name">Name:</label>
        <input type="text" name="name" required>

        <label for="email">Email:</label>
        <input type="email" name="email" required>

        <label for="payment">Zahlungsart:</label>
        <select name="payment" required>
            <option value="Bar">Bar</option>
            <option value="PayPal">PayPal</option>
        </select>

        <!-- Hartweizen-Header -->
        <h2 class="hartweizen-header">üçù Hartweizen-Nudeln</h2>

        <table class="order-table">
            <thead>
                <tr>
                    <th>Bild</th>
                    <th>Nudel (500g)</th>
                    <th>Preis (‚Ç¨)</th>
                    <th>Menge</th>
                </tr>
            </thead>
            <tbody>
                {% for noodle in noodles if not noodle.lower().startswith('dinkel') %}
                <tr>
                    <td><img src="{{ url_for('static', filename='images/' + noodle|replace(' ', '_') + '.JPG') }}" alt="{{ noodle }}"></td>
                    <td>{{ noodle }}</td>
                    <td>2.5</td>
                    <td>
                        <input type="number" name="qty_{{ loop.index }}" min="0" value="0">
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- Dinkel-Header -->
        <h2 class="dinkel-header">üåø Dinkel-Nudeln</h2>

        <table class="order-table">
            <thead>
                <tr>
                    <th>Bild</th>
                    <th>Nudel (500g)</th>
                    <th>Preis (‚Ç¨)</th>
                    <th>Menge</th>
                </tr>
            </thead>
            <tbody>
                {% for noodle in noodles if noodle.lower().startswith('dinkel') %}
                <tr>
                    <td><img src="{{ url_for('static', filename='images/' + noodle|replace(' ', '_') + '.JPG') }}" alt="{{ noodle }}"></td>
                    <td>{{ noodle }}</td>
                    <td>2.5</td>
                    <td>
                        <input type="number" name="qty_{{ loop.index }}" min="0" value="0">
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <h3 id="summary">Gesamtanzahl: 0 Packungen<br>Gratis-Packungen: 0<br>Zu zahlen: 0.00 ‚Ç¨</h3>

        <button type="submit">Bestellen</button>
    </form>

    <script>
        // ‚úÖ JS: Preisberechnung im Frontend
        const pricePerPack = 2.5;
        const qtyInputs = document.querySelectorAll('input[type="number"]');
        const summary = document.getElementById("summary");

        function updateSummary() {
            let totalQty = 0;
            qtyInputs.forEach(input => {
                totalQty += parseInt(input.value) || 0;
            });

            // Gratis-Packungen berechnen
            let freePacks = Math.floor(totalQty / 10);
            let totalPrice = (totalQty - freePacks) * pricePerPack;

            summary.innerHTML = `Gesamtanzahl: ${totalQty} Packungen<br>
                                 Gratis-Packungen: ${freePacks}<br>
                                 Zu zahlen: ${totalPrice.toFixed(2)} ‚Ç¨`;
        }

        qtyInputs.forEach(input => {
            input.addEventListener("input", updateSummary);
        });
    </script>

</body>
</html>
